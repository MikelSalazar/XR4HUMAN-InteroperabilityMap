<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Interoperability Map - XR4HUMAN</title>
		<meta name="author" content="Mikel Salazar, Alina Kadlubsky, Sathiya Kumar">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAEv0lEQVR4nO2ba0gUURTHbxEVqWSalZnaB6WgfAQFEQsWNRW9lIoeRKTk0NCGWkggPdYtyCCLsqiRYSvqS4HKGhjmRGkIfUhy1STIol0z6AGZlT2oZeMOs6LOvTPjzszOdXd/MF/mce85/5175pwzsxN8Ph8IZyaGtfcRAQCYRIANAoethyx/fv9aijp21eG4aNjEMAaYvZ0pL9/Q0d7+zYeBrapqNMpG050vOWi1yDnv5/L58zVGzG96DIC3fWZ2dozSebEzYtOMmD/sg2BEAAJsMJWIAGYbkJySYkhwU4vpAsTFxSkK8PnjR9DzqqfRiPkDLoYO7t9fomVi+MtD57fu2LHuZXc36PW4O/7+/ZceHx8/bfS57rdvbUWlpae0zIdlLEnDsaNHC69XV7fW19Qo5S2qedHZ6YPJkFmJmOps7fZ1h+vThw+6Oe5HFNO0TFSxGKqw2zcU0IV31GRr4xHZIAid35ibG7LOQ7AClBYVpy5fseJuKDsPwQqQnp5WvYqiooNrTvBBxgDYnChkDqyTs6bT5fr+sLGx7nVPj2v0scSkpNWM1bopYfbs8SnArFkJuxZlZGAv6u7qAg319bvKbLb7mFMuVlVWnty9d69dLxFYinMDAFIxhwcAAM0AACfcGJ7+qnZc5BKYk5iYLXdRe9uzDhnnBWDi0trSMqjWEBXclDllOgAgFwBwA+ZNLMWVqx0UKUB0TIwu+fng4I/XeowzRqAYNpbiXCzFxSpdihRgyuTJ5C9eZbLgslASIdTL4SwxLmAJh35ADktx2MLNUAGioqJNrfWHUY5bChIBbGVlZ7ds2yY72pKly7Jgmix3ztnTpw9bcnKiArUYgWJAkwEGxjzUYUkesDgzM19pNJgjeL3eOxV2+613vb2SSD8zIWH5zj17duqYA0CbijUOk4d6lI5oiFTY7VfKbDarxokkNDU0vHrR1fUUdexLf3/rvOdpFgDAfJkhcnQww8PwtGSOoTsAFj8bN2/ap8NEI4DONz1oWltZdcmDO4elOE7veREgs8ghAebOTbQbUfw46+quXXU4sM6bjRAEYfGzZv36raQaaSSCAAsXLjge6nU/DkEAj6c348mjR0QaqCcsxUmKPEGAM5Xnku456+eXFhWfuHLhQi0sd0MUyYcWyPcC92prfUrJkBpUPgHyxTI2WKxieLrZP5fmT2Tg0vna3y/Z/3Pw55u2tjbSnAfiXTC0FDTdAbAtptAZEhDXXrOYkpJAAcPTQlYYcDH0mOd/jFPnIUMdo4AFeN/37o2S8yJ5hDkPSfW3zcL5+4ASWCIT851gkPB3j4UNdo/DSgCGpyU9BeQS8Hq9eraziQYpwPu+Pj2/xlDq5AyYKRByCRw6cmQ7bI4kpyRbcBd63J6pY5inBbPfKQpkG8NYumL6/wXEx1FQBGB4esLofZqCoGh8CeY53wEAyGd4WvLylCQCzgNYissTfzlckqPqzYzZaEmEkG3mUUwfXniEmgByXdxxAwmpsNxrbz1BPolMF4DhafjhQ4HB+UCLGKwlEJEKi7V5sO6EEWi5A9wG2BN0tAgg+95dZGB4/41EAhaA4WmnuHZxPT+47laS7Dwk8tdZAmwwlYgABNhgKuEtAADgP7HCi/kWyv87AAAAAElFTkSuQmCC" >
	</head>
	<body>
		<script type="module">
class NodeType{constructor(name,tag,parent,prototype){this._name=name;this._tag=tag||name.toLowerCase();this._parent=parent;this._children={};this._childCount=0;this._childTags={};if(parent){parent._children[name]=parent._childTags[tag]=this;parent._childCount++}this._prototype=prototype}get name(){return this._name}get tag(){return this._tag}get serializable(){return this._serializable}get parent(){return this._parent}get children(){return this._children}get childCount(){return this._childCount}get childTags(){return this._childTags}get prototype(){return this._prototype}is(typeName){if(this._name==typeName)return true;if(this._parent!=undefined&&this._parent.is(typeName))return true;return false}toString(){return this._name}}class Node{constructor(name,parent,data,type=Node.type){this._name=name;this._type=type;if(!name||Node.reservedWords.includes(name))throw Error("Invalid node name: "+(!name?"(undefined)":'"'+name+'"')+(parent?" for: "+parent.nodePath:""));this._parent=parent;this._children={};if(parent){let uniqueName=this._name,nameIndex=1;while(parent.children[uniqueName])uniqueName=this._name+nameIndex++;parent.children[uniqueName]=this}this._links=[];this._serializable=true;if(data!=undefined)this.deserialize(data);this._updated=false}get isNode(){return true}get name(){return this._name}get type(){return this._type}get parent(){return this._parent}get children(){return this._children}get links(){return this._links}get nodePath(){return(this._parent?this._parent.nodePath+"/":"")+this._name}get updated(){return this._updated}set updated(updated){if(updated==false){if(this._parent)this._parent.updated=false;for(let link of this._links)link.updated=false}this._updated=updated}get serializable(){return this._serializable}set serializable(serializable){this._serializable=serializable}get debug(){return this._debug}set debug(d){this._debug=d}update(time=0,forced=false){if(this.updated&&!forced)return;let children=Object.values(this._children);for(let child of children){child.update(time,forced)}this._updated=true}deserialize(data){if(data==undefined)return;let items=Object.keys(data);for(let item of items)if(this._children[item]!=undefined&&data[item]!=undefined)this.children[item].deserialize(data[item]);if(data.debug)this._debug=data}serialize(options={}){if(!this.serializable)return;let data={},itemCount=0;if(this._name)data.name=this._name;if(this._type)data.type=this._type.tag;for(let childName in this._children){let item=this._children[childName].serialize(options);data[childName]=item;itemCount++}return itemCount>0?data:undefined}toString(){return JsonSerialization.serialize(this,{optimize:false})}ancestor(type){let searchNode=this._parent;while(searchNode!=null){if(searchNode._type.is(type.name))return searchNode;searchNode=searchNode.parent}}relative(path){let node=this;let parts=path.split("/");for(let part of parts){if(part==".."){if(node._parent)node=node._parent;else throw Error("There in no parent node for:"+node.nodePath)}else{let child;if(node._type.name=="NodeSet")child=node.get(part);else child=node._children[part];if(!child)throw Error('Invalid child node: "'+part+'" for:'+node.nodePath);node=child}}return node}[Symbol.iterator](){let pointer=0,nodes=Object.values(this._children);return{next(){if(pointer<nodes.length)return{done:false,value:nodes[pointer++]};else return{done:true,value:null}}}}static modified(...nodes){for(let node of nodes){if(node.updated==false)return true}return false}}Node.type=new NodeType("Node","node",undefined,Node);Node.reservedWords=["name","debug"];class NodeSet extends Node{constructor(name,parent,itemType,data){super(name,parent,undefined,NodeSet.type);if(!itemType)throw Error("Invalid itemType for: "+this.nodePath);this._itemType=itemType;this._indexed=false;if(data!=undefined)this.deserialize(data)}get children(){return this._children}get itemType(){return this._itemType}get indexed(){return this._indexed}get names(){return Object.keys(this.children)}get count(){return Object.keys(this.children).length}get first(){return this.getByIndex(0)}get last(){return this.getByIndex(this.count-1)}add(name,data){let itemType=this._itemType;if(!name)name=data.name;if(!name)name=this._itemType.name+"_"+(this.count+1);if(itemType.childCount>0&&data.type&&data.type!=itemType.tag){let subItemType=itemType.childTags[data.type];if(!subItemType)throw Error('Invalid Node type for: "'+this.nodePath+'". Valid node types are: "'+Object.keys(itemType.childTags).join('", "')+'"');itemType=subItemType}return new itemType.prototype(data.name||name,this,data)}get(key){return this._children[key]}getByIndex(index){return Object.values(this._children)[index]}remove(key){this._children[key]=undefined}removeByIndex(index){this._children[Object.keys(this._children)[index]]=undefined}clear(){this._children={}}deserialize(data){if(data==undefined)return;if(Array.isArray(data)){this._indexed=true;let index=0;for(let value of data)this.add(undefined,value)}else if(typeof data=="object"){this._indexed=false;for(let key in data)this.add(key,data[key])}else throw Error("Invalid node set data")}serialize(options={}){if(this._indexed==true){let array=[];let children=Object.values(this._children);for(let child of children)array.push(child.serialize(options));return array.length>0?array:undefined}else{let obj={},itemCount=0;for(let childName in this._children){let item=this.children[childName].serialize(options);if(item==undefined)continue;if(options.removeTyping){if(!this.indexed&&item.name==childName)item.name=undefined;if(item.type==this._itemType.tag)item.type=undefined}obj[childName]=item;itemCount++}let keyCount=Object.keys(obj).length;return options.optimize&&keyCount==0?undefined:obj}}[Symbol.iterator](){let pointer=0,nodes=Object.values(this._children);return{next(){if(pointer<nodes.length)return{done:false,value:nodes[pointer++]};else return{done:true,value:null}}}}}NodeSet.type=new NodeType("NodeSet","set",Node.type,NodeSet);class NodeLink extends Node{constructor(name,parent,data){super(name,parent,undefined,NodeLink.type);this._origin="";this._reference=undefined;this._strength=1;this._node=undefined;if(data!=undefined)this.deserialize(data)}get origin(){return this._origin}get reference(){return this._reference}set reference(r){if(this._reference==r)return;this._reference=r;this.updated=false}get strength(){return this._strength}set strength(s){if(this._strength==s)return;this._strength=s;this.updated=false}get node(){return this._node}update(time=0,forced=false){if(this.updated&&!forced)return;if(!this._reference)return;let parts=(this._origin+this._reference).split("/"),upwards=this._parent,downwards;while(parts[0]==".."){parts.shift();if(upwards.parent)upwards=upwards.parent}this._node=undefined;let partIndex=0,partCount=parts.length;while(upwards&&!this._node){downwards=upwards;upwards=upwards.parent;for(partIndex=0;partIndex<partCount;partIndex++){let part=parts[partIndex];downwards=downwards.children[part];if(!downwards)break;if(partIndex==partCount-1)this._node=downwards}}if(this._node){this._node.links.push(this)}else console.log('No link found for: "'+this.nodePath+'" using reference "'+this._reference+'"');this._updated=true}deserialize(data){switch(typeof data){case"object":this._reference=data.reference;this._origin=data.origin||"";this._strength=data.strength||1;break;case"string":this._reference=data;break;default:throw Error("Invalid reference for: "+this.nodePath)}}serialize(){return this.reference}}NodeLink.type=new NodeType("Link"," link",Node.type,NodeLink);class NodeLinkSet extends Node{constructor(name,parent,itemType,data,origin=""){super(name,parent,undefined,NodeLinkSet.type);if(!name)throw Error("No name provided for: "+this.nodePath);if(!itemType)throw Error("Invalid itemType for: "+this.nodePath);this._itemType=itemType;this._indexed=undefined;this._origin=origin;if(data!=undefined)this.deserialize(data)}get origin(){return this._origin}get children(){return this._children}get itemType(){return this._itemType}get indexed(){return this._indexed}get names(){return Object.keys(this.children)}get count(){return Object.keys(this.children).length}get first(){return this.getChildByIndex(0)}get last(){return this.getChildByIndex(this.count-1)}addChild(name,data){let itemType=this._itemType;if(itemType.childCount>0&&data.type&&data.type!=itemType.tag){let subItemType=itemType.childTags[data.type];if(!subItemType)throw Error('Invalid Node type for: "'+this.nodePath+'". Valid node types are: "'+Object.keys(itemType.childTags).join('", "')+'"');itemType=subItemType}return new NodeLink(data.name||name,this,data)}getChild(key){return this._children[key]}getChildByIndex(index){return Object.values(this._children)[index]}remove(key){this._children[key]=undefined}removeChildByIndex(index){this._children[Object.keys(this._children)[index]]=undefined}clear(){this._children={}}deserialize(data){if(data==undefined)return;if(Array.isArray(data)){this._indexed=true;let index=0;for(let value of data)this.addChild((index++).toString(),{reference:value,origin:this._origin})}else if(typeof data=="object"){this._indexed=false;for(let key in data){if(typeof data[key]=="number")this.addChild(key,{reference:key,strength:data[key]});else this.addChild(key,data[key])}}else throw Error("Invalid node set data")}serialize(){if(this._indexed==true){let array=[];let children=Object.values(this._children);for(let child of children)array.push(child.serialize());return array.length>0?array:undefined}else{let obj={},itemCount=0;for(let childName in this._children){let item=this.children[childName].serialize();if(item!=undefined){obj[childName]=item;itemCount++}}return Object.keys(obj).length>0?obj:undefined}}[Symbol.iterator](){let pointer=0,nodes=Object.values(this._children);return{next(){if(pointer<nodes.length)return{done:false,value:nodes[pointer++]};else return{done:true,value:null}}}}}NodeLinkSet.type=new NodeType("NodeLinkSet","links",Node.type,NodeLinkSet);class JsonSerialization{static deserialize(jsonString,node){jsonString=jsonString.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"");jsonString=jsonString.replace(/\,\s*\n(\s*[}|\]])/gm,"\n$1");let data=JSON.parse(jsonString);if(node)node.deserialize(data);return data}static serialize(data,options={}){if(options.removeTyping==undefined)options.removeTyping=true;if(data.isNode)data=data.serialize(options);if(data==undefined)return"(Undefined)";let result=JSON.stringify(data,null,"\t");if(result.length<80)result=result.replace(/\n\t*/g," ");return result}static serializeNode(data,options={}){let name=options.name,tabLevel=options.tabLevel||0,multiline=options.multiline||true,separator=options.minify?options.separator:"",itemSeparator=options.itemSeparator||",",tabString=options.tabString||"\t",tabSize=options.tabSize||4,maxLineSize=options.maxLineSize||80,lineSeparator=options.minify?"\n":"";let itemParams={...options};itemParams.tabLevel=tabLevel+1;let node={name:name,items:[],type:Array.isArray(data)?"array":typeof data,text:name?'"'+name+'":'+separator:"",multiline:false,separator:itemSeparator};if(data==null){node.text="null";return node}node.type=Array.isArray(data)?"array":typeof data;switch(node.type){case"boolean":node.text+=data?"true":"false";break;case"bigint":node.text+=data+"n";break;case"number":node.text+=data;break;case"string":node.text+='"'+data.replace(/\"/g,'\\"')+'"';break;case"array":node.start="[",node.end="]";node.separator=itemSeparator;for(let item of data)node.items.push(this.serializeNode(item,itemParams));break;case"object":if(data.type=="comment"){if(data.text.includes("\n")){node.text="";let lines=data.text.split("\n");for(let line of lines)node.items.push({text:line,separator:"",tabLevel:tabLevel});node.items[0].text="/* "+node.items[0].text;node.items[0].tabLevel=0;node.items[lines.length-1].text+=" */"}else node.text="// "+data.text;node.separator="";node.multiline=true;break}node.start="{",node.end="}";node.separator=itemSeparator;for(let itemName in data)node.items.push(this.serializeNode(data[itemName],itemParams));break}if(node.items.length==0)return node;let line="",lineSize=0,itemIndex,itemCount=node.items.length;for(itemIndex=0;itemIndex<itemCount;itemIndex++){if(node.items[itemIndex].multiline==true){node.multiline=true;break}}if(node.multiline==false||multiline==false){if(node.start)line=node.start+separator;for(itemIndex=0;itemIndex<itemCount;itemIndex++){let item=node.items[itemIndex];line+=item.text+(itemIndex<itemCount-1?item.separator+separator:"")}if(node.end)line+=separator+node.end;lineSize=tabLevel+tabSize+line.length;node.multiline=lineSize>maxLineSize}if(multiline&&node.multiline){if(node.start)node.text+=node.start+lineSeparator;for(itemIndex=0;itemIndex<itemCount;itemIndex++){let item=node.items[itemIndex];let tl=item.tabLevel!=undefined?item.tabLevel:tabLevel+1;node.text+=tabString.repeat(tl)+item.text;if(itemIndex<itemCount-1)node.text+=item.separator+lineSeparator}if(node.end)node.text+=lineSeparator+tabString.repeat(tabLevel)+node.end;node.multiline=true}else node.text+=line;return node}}class Simple extends Node{constructor(name,parent,data,def,type=Simple.type){super(name,parent,undefined,type);if(def!=undefined)this._default=def;if(data!=undefined)this.deserialize(data)}get value(){return this._value!=undefined?this._value:this._default}set value(newValue){if(this._value!=newValue)this.updated=false;this._value=newValue}get default(){return this._default}set default(newDefault){if(typeof newDefault!="string")newDefault=""+newDefault;if(this._default!=newDefault)this.updated=false;this._default=newDefault}get isUndefined(){return this._value==undefined}get isDefault(){return this._default!=undefined&&this._value==this._default}deserialize(data){this.value=data}serialize(options={}){return this.value}}Simple.type=new NodeType("Simple","simple",Node.type,Simple);class Boolean extends Simple{constructor(name,parent,data,def){super(name,parent,undefined,def,Boolean.type);this._link=new NodeLink("link",this);if(data!=undefined)this.deserialize(data)}get value(){return this._value!=undefined?this._value:this.default}set value(newValue){if(typeof newValue!="boolean"){switch(typeof newValue){case"number":newValue=newValue!=0;break;case"string":newValue=newValue=="true";break;default:throw Error("Invalid data type for: "+this.nodePath)}}if(this.value!=newValue)this.updated=false;this._value=newValue}get default(){return this._default}set default(newDefault){if(this._default!=newDefault)this.updated=false;this._default=newDefault}deserialize(data){this.value=data}serialize(){return this.value}}Boolean.type=new NodeType("Boolean","boolean",Simple.type,Boolean);class Number extends Simple{constructor(name,parent,data,def,min,max){super(name,parent,undefined,def,Number.type);this._link=new NodeLink("link",this);if(min!=undefined)this._min=min;if(max!=undefined)this._max=max;if(data!=undefined)this.deserialize(data)}get value(){return this._value!=undefined?this._value:this.default}set value(newValue){if(typeof newValue!="number"){switch(typeof newValue){case"string":newValue=parseFloat(newValue);break;case"boolean":newValue=newValue?1:0;break;case"object":newValue=newValue.value;break;case"undefined":newValue=undefined;break;default:throw Error('Invalid data type for: "'+this.nodePath+'" '+JSON.stringify(newValue))}}if(this._value!=newValue)this.updated=false;if(this._min!=undefined&&newValue<this._min)throw Error('Invalid value "'+newValue+'" for '+this.nodePath+' (minimum value is: "'+this._min+'")');if(this._max!=undefined&&newValue>this._max)throw Error('Invalid value "'+newValue+'" for '+this.nodePath+' (maximum value is: "'+this._max+'")');this._value=newValue}get default(){return this._default}set default(newDefault){if(this._default!=newDefault)this.updated=false;this._default=newDefault}get min(){return this._min}set min(newMin){if(this._min!=newMin)this.updated=false;if(this.min!=undefined&&newMin>this._max)throw Error('Invalid minimum value "'+newMin+'" for '+this.nodePath+' (maximum value is: "'+this._max+'")');this._min=newMin}get max(){return this._max}set max(newMax){if(this._max!=newMax)this.updated=false;if(this.max!=undefined&&newMax<this._min)throw Error('Invalid maximum value "'+newMax+'" for '+this.nodePath+' (minimum value is: "'+this._min+'")');this._max=newMax}deserialize(data){switch(typeof data){case"object":this._min=data.min;this._max=data.max;this._default=data.default;this.value=data.value;this._link.reference=data.link;break;case"undefined":this.value=undefined;break;default:this.value=data}}serialize(){return this.value}toString(){return Number.toString(this._value)}static toString(value){if(value==undefined)return"undefined";let string=value.toFixed(5),point=string.indexOf("."),cursor=point+1,l=string.length;while(cursor>0&&cursor<l-1){if(string[cursor]=="0"&&string[cursor+1]=="0"){if(cursor==point+1)cursor=point;string=string.slice(0,cursor);break}cursor++}return string}}Number.type=new NodeType("Number","number",Simple.type,Number);class String extends Simple{constructor(name,parent,data,def,validValues){super(name,parent,undefined,def,String.type);this._validValues=validValues||[];this._link=new NodeLink("link",this);if(data!=undefined)this.deserialize(data)}get value(){return this._value!=undefined?this._value:this._default}set value(newValue){if(newValue!=undefined){let values=this._validValues;if(values.length>0&&!values.includes(newValue))throw Error('Invalid value: "'+newValue+'" for: "'+this.nodePath+'". Valid values are: '+values.join(", "));else if(typeof newValue!="string")newValue=""+newValue}if(this._value!=newValue)this.updated=false;this._value=newValue}get default(){return this._default}set default(newDefault){if(typeof newDefault!="string")newDefault=""+newDefault;if(this._default!=newDefault)this.updated=false;this._default=newDefault}get validValues(){return this._validValues}update(time,forced=false){if(this._link.reference){if(!this._link.updated)this._link.update();this.value=this._link.node._value}super.update()}deserialize(data){switch(typeof data){case"object":this._default=data.default;this.value=data.value;this._validValues=data.validValues||[];this._link.reference=data.link;break;case"undefined":this.value=undefined;break;default:this.value=""+data}}serialize(options={}){let data={};if(this._value!=undefined)data.value=this._value;if(this._link.reference!=undefined)data.link=this._link.reference;if(options.optimize&&!data.value&&!data.link)return;return data}}String.type=new NodeType("String","string",Simple.type,String);class Vector extends Node{constructor(name,parent,data,def){super(name,parent,undefined,Vector.type);let d={x:0,y:0,z:0};if(def){if(Array.isArray(def)){for(let i=0;i<3;i++)if(def.length>i)d.x=def[i]}else if(typeof def=="object"){d={x:def.x||0,y:def.y||0,z:def.z||0}}else if(typeof def=="number")d={x:def,y:def,z:def};else throw Error("Invalid definition value for:"+this.nodePath)}this._x=new Number("x",this,undefined,d.x);this._y=new Number("y",this,undefined,d.y);this._z=new Number("z",this,undefined,d.z);if(data!=undefined)this.deserialize(data)}get x(){return this._x}get y(){return this._y}get z(){return this._z}get isUndefined(){return this._x.isUndefined&&this._y.isUndefined&&this._z.isUndefined}get isDefault(){return this._x.isDefault&&this._y.isDefault&&this._z.isDefault}get length(){let x=this._x.value,y=this._y.value,z=this._z.value;return Math.sqrt(x*x+y*y+z*z)}get values(){return{x:this._x.value,y:this._y.value,z:this._z.value}}set values(values){if(values.x!=undefined)this._x.value=values.x;if(values.y!=undefined)this._y.value=values.y;if(values.z!=undefined)this._z.value=values.z}deserialize(data){if(Array.isArray(data)){if(data.length>0)this.x.value=data[0];if(data.length>1)this.y.value=data[1];if(data.length>2)this.z.value=data[2]}else if(typeof data=="object"){if(data.x!=undefined)this.x.value=data.x;if(data.y!=undefined)this.y.value=data.y;if(data.z!=undefined)this.z.value=data.z}else if(typeof data=="boolean"){this.x.value=this.y.value=this.z.value=data==true?1:0}else if(typeof data=="number"){this.x.value=this.y.value=this.z.value=data}else if(typeof data=="string"){this.x.value=this.y.value=this.z.value=parseFloat(data)}else throw Error('Invalid value: "'+data.toString()+'" for:'+this.nodePath)}serialize(){if(!this._x.isDefault||!this._y.isDefault||!this._z.isDefault)return[this._x.value,this._y.value,this._z.value]}clone(parent){return new Vector(this._name,parent,this.values)}copy(vector){this._x.value=vector._x.value;this._y.value=vector._y.value;this._z.value=vector._z.value}set(x=0,y=0,z=0){if(x!=undefined)this._x.value=x;if(y!=undefined)this._y.value=y;if(z!=undefined)this._z.value=z}addValues(x=0,y=0,z=0){if(x!=undefined)this._x.value+=x;if(y!=undefined)this._y.value+=y;if(z!=undefined)this._z.value+=z}subtractValues(x=0,y=0,z=0){if(x!=undefined)this._x.value+=x;if(y!=undefined)this._y.value+=y;if(z!=undefined)this._z.value+=z}normalize(){let x=this._x.value,y=this._y.value,z=this._z.value,l=Math.sqrt(x*x+y*y+z*z);if(x)this._x.value/=l;if(y)this._y.value/=l;if(z)this._z.value/=l}static distance(v1,v2){let dx=v2._x.value-v1._x.value,dy=v2._y.value-v1._y.value,dz=v2._z.value-v1._z.value;return Math.sqrt(dx*dx+dy*dy+dz*dz)}equals(v){return this._x.value==v._x.value&&this._y.value==v._y.value&&this._z.value==v._z.value}static equals(v1,v2){return v1._x.value==v2._x.value&&v1._y.value==v2._y.value&&v1._z.value==v2._z.value}static interpolate(v1,v2,t){return new Vector("vector",undefined,[v1._x.value+(v2._x.value-v1._x.value)*t,v1._y.value+(v2._y.value-v1._y.value)*t,v1._z.value+(v2._z.value-v1._z.value)*t])}}Vector.type=new NodeType("Vector","vector",Node.type,Vector);class Color extends Node{constructor(name,parent,data){super(name,parent,undefined,Color.type);this._r=new Number("r",this,undefined,0,0,1);this._g=new Number("g",this,undefined,0,0,1);this._b=new Number("b",this,undefined,0,0,1);this._a=new Number("a",this,undefined,1,0,1);this._text=new String("text",this);if(data!=undefined)this.deserialize(data)}get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}get text(){return this._text}get isDefault(){return this.r.isDefault&&this.g.isDefault&&this.b.isDefault&&this.a.isDefault&&this._text.isDefault}get isUndefined(){return this.r.isUndefined&&this.g.isUndefined&&this.b.isUndefined&&this.a.isUndefined&&this._text.isUndefined}get hex(){let r=Math.floor(this._r.value*255).toString(16).padStart(2,"0"),g=Math.floor(this._g.value*255).toString(16).padStart(2,"0"),b=Math.floor(this._b.value*255).toString(16).padStart(2,"0"),a=this._a.value==1?"":Math.floor(this._a.value*255).toString(16).padStart(2,"0");return"#"+r+g+b}set hex(v){try{this._text.value=undefined;if(v[0]=="#")v=v.slice(1);let charCount=v.length,short=charCount<5;if(charCount<3)throw Error("Wrong value");let r=parseInt(short?v[0]+v[0]:v[0]+v[1],16);this._r.value=r>0?r/255:0;let g=parseInt(short?v[1]+v[1]:v[2]+v[3],16);this._g.value=g>0?g/255:0;let b=parseInt(short?v[2]+v[2]:v[4]+v[5],16);this._b.value=b>0?b/255:0;if(!(charCount==4||charCount==8))return;let a=parseInt(short?v[3]+v[3]:v[6]+v[7],16);this._a.value=a>0?a/255:0}catch(e){throw Error('Invalid Hex value "'+v+'" for '+this.nodePath)}}deserialize(data){if(Array.isArray(data)){if(data.length>0)this._r.value=data[0];if(data.length>1)this._g.value=data[1];if(data.length>2)this._b.value=data[2];if(data.length>3)this._a.value=data[3]}else{let dataType=typeof data;if(typeof data=="object"){if(data.r!=undefined)this._r.value=data.r;if(data.g!=undefined)this._g.value=data.g;if(data.b!=undefined)this._b.value=data.b;if(data.a!=undefined)this._a.value=data.a}else if(dataType=="number"){this._r.value=this._g.value=this._b.value=data}else if(dataType=="string"){if(data.startsWith("#"))this.hex=data;else this._text.value=data}else throw Error('Invalid value: "'+data.toString()+'" '+'of type"'+dataType+'" for: '+this.nodePath)}}serialize(){if(this.text.value)return this.text.value;let v=[this._r.value,this._g.value,this._b.value,this._a.value];if(v[0]==0&&v[1]==0&&v[2]==0&&v[3]==1)return undefined;if(v[3]==1)v.pop();return v}copy(color){this._r.value=color._r.value;this._g.value=color._g.value;this._b.value=color._b.value;this._a.value=color._a.value;this._text.value=color._text.value}toString(){return this._text.value?this._text.value:this.hex}static interpolate(c1,c2,t){return new Color("color",undefined,[c1._r.value+(c2._r.value-c1._r.value)*t,c1._g.value+(c2._g.value-c1._g.value)*t,c1._b.value+(c2._b.value-c1._b.value)*t])}}Color.type=new NodeType("Color","color",Node.type,Color);class BoundingBox extends Node{constructor(name,parent,data){super(name,parent,null,BoundingBox.type);this._min=new Vector("min",this,null,Number.NEGATIVE_INFINITY);this._max=new Vector("max",this,null,Number.POSITIVE_INFINITY);this._center=new Vector("center",this);this._size=new Vector("size",this,null,Number.POSITIVE_INFINITY);if(data!=undefined)this.deserialize(data)}get min(){return this._min}get minX(){return this._min.x.value}get minY(){return this._min.y.value}get minZ(){if(!this.updated)return this._min.z.value}get max(){return this._max}get maxX(){return this._max.x.value}get maxY(){return this._max.y.value}get maxZ(){return this._max.z.value}get center(){return this._center}get x(){return this._center.x.value}get y(){return this._center.y.value}get z(){return this._center.z.value}get width(){return this._size.x.value}get height(){return this._size.y.value}get depth(){return this._size.z.value}serialize(){return undefined}}BoundingBox.type=new NodeType("BoundingBox","bb",Node.type,BoundingBox);class Item extends Node{constructor(name,parent,data,type=Item.type){super(name,parent,undefined,type);this._title=new String("title",this);this._description=new String("description",this);this._forms=new NodeSet("forms",this,Form.type);if(data!=undefined)this.deserialize(data)}get title(){return this._title}get description(){return this._description}get forms(){return this._forms}}Item.type=new NodeType("Item","item",Node.type,Item);class Form extends Node{constructor(name,parent,data){super(name,parent,undefined,Form.type);this._title=new String("title",this);this._description=new String("description",this);this._points=new NodeSet("points",this,Vector.type);this._color=new Color("color",this);this._offset=new Number("offset",this);this._position=new Vector("position",this);this._values=new NodeSet("values",this,Number.type);if(data!=undefined)this.deserialize(data)}get title(){return this._title}get description(){return this._description}get points(){return this._points}get color(){return this._color}get offset(){return this._offset}get position(){return this._position}get values(){return this._values}}Form.type=new NodeType("Form","form",Node.type,Form);class Model extends Node{constructor(name,parent,data){super(name,parent,undefined,Model.type);this._domains=new NodeSet("domains",this,Domain.type);this._classes=new NodeSet("classes",this,Class.type);this._relations=new NodeSet("relations",this,Relation.type);if(data!=undefined)this.deserialize(data)}get domains(){return this._domains}get classes(){return this._classes}get relations(){return this._relations}}Model.type=new NodeType("Model","model",Node.type,Model);class Domain extends Item{constructor(name,parent,data){super(name,parent,undefined,Domain.type);this._extends=new NodeLink("extends",this);this._classes=new NodeLinkSet("classes",this,Class.type,undefined,"../../../classes/");if(data!=undefined)this.deserialize(data)}get extends(){return this._extends}get classes(){return this._classes}}Domain.type=new NodeType("Domain","domain",Item.type,Domain);class Class extends Item{constructor(name,parent,data){super(name,parent,undefined,Class.type);this._abstract=new Boolean("abstract",this);this._domains=new NodeLinkSet("domains",this,Domain.type,undefined,"../../../domains/");this._relations=new NodeLinkSet("relations",this,Relation.type,undefined,"../../../relations/");this._extends=new NodeLink("extends",this);this._properties=new NodeSet("properties",this,Property.type);this._instances=new NodeSet("instances",this,ClassInstance.type);if(data!=undefined)this.deserialize(data)}get abstract(){return this._abstract}get domains(){return this._domains}get relations(){return this._relations}get extends(){return this._extends}get properties(){return this._properties}get instances(){return this._instances}}Class.type=new NodeType("Class","class",Node.type,Class);class Property extends Item{constructor(name,parent,data){super(name,parent,undefined,Property.type);if(data!=undefined)this.deserialize(data)}}Property.type=new NodeType("Property","property",Item.type,Property);class ClassInstance extends Item{constructor(name,parent,data){super(name,parent,undefined,ClassInstance.type);this._class=new NodeLink("class",this);this._properties=new NodeSet("properties",this,Property.type);if(data!=undefined)this.deserialize(data)}get class(){return this._class}get properties(){return this._properties}}ClassInstance.type=new NodeType("ClassInstance","class_instance",Node.type,ClassInstance);class Relation extends Item{constructor(name,parent,data){super(name,parent,undefined,Relation.type);this._extends=new NodeLink("extends",this);this._instances=new NodeSet("instances",this,RelationInstance.type);this._classes=new NodeLinkSet("classes",this,Class.type,undefined,"../../../classes/");if(data!=undefined)this.deserialize(data)}get extends(){return this._extends}get instances(){return this._instances}get classes(){return this._classes}}Relation.type=new NodeType("Relation","relation",Item.type,Relation);class RelationInstance extends Item{constructor(name,parent,data){super(name,parent,undefined,RelationInstance.type);this._relation=new NodeLink("relation",this);this._origin=new NodeLink("origin",this);this._target=new NodeLink("target",this);if(data!=undefined)this.deserialize(data)}get relation(){return this._relation}get origin(){return this._origin}get target(){return this._target}}RelationInstance.type=new NodeType("RelationInstance","relation_instance",Item.type,RelationInstance);class Component{constructor(tag,name,parent,attributes,content,unique=false){if(tag)this._tag=tag;else throw Error("Invalid SVG tag");if(name)this._name=name;if(SHISHOU.environment=="browser"){if(name&&unique)this._element=document.getElementById(name);if(!this._element){this._element=document.createElementNS("http://www.w3.org/2000/svg",tag);if(name)this._element.setAttribute("id",name);let parentElement=parent?parent._element:document.body;parentElement.appendChild(this._element)}}this._attributes={};let a=attributes;if(attributes!=undefined&&typeof attributes=="object")for(let key in attributes)this.set(key,attributes[key]);this._animations={};if(content)this.content=content;else this._content="";this._children=[];if(parent!=undefined)parent.addChild(this)}get tag(){return this._tag}get name(){return this._name}get width(){return this._width}set width(w){this._width=w}get height(){return this._height}set height(h){this._height=h}get content(){return this._content}set content(c){this._content=c;if(this._element)this._element.innerHTML=c}get element(){return this._element}get parent(){return this._parent}get children(){return this._children}get animations(){return this._animations}get rootName(){return this._parent?this._parent.rootName:this.name}addChild(child){this.children.push(child);child._parent=this;this.element.appendChild(child.element)}getChild(name){for(let child of this._children)if(child.name==name)return child}get(name){return this._attributes[name]}set(name,value){if(typeof value=="number")value=Number.toString(value);if(name.indexOf("_")>=0)name=name.replace(/_/g,"-");this._attributes[name]=value;if(this._element)this._element.setAttribute(name,value)}bringToFront(){if(this._element&&this._element.parentNode){if(!this._element.nextElementSibling)return;let parent=this._element.parentNode;parent.removeChild(this._element);parent.appendChild(this._element)}}toString(tabLevel=0){let tabs="\t".repeat(tabLevel),result=tabs+"<"+this.tag;if(this._name)result+=' id="'+this._name+'"';for(let key in this._attributes)result+=" "+key+'="'+this._attributes[key]+'"';if(this._content)return result+">"+this._content+"</"+this.tag+">";if(this._children.length==0&&tabLevel>2)return result+"/>";result+=">";for(let child of this._children)result+="\n"+child.toString(tabLevel+1);return result+"\n"+tabs+"</"+this.tag+">"}}Component.anchor=["none","top-left","top","top-right","left","center","right","bottom-left","bottom","bottom-right"];class Element extends Node{constructor(name,parent,data,type=Element.type,component){super(name,parent,undefined,type);this._position=new Vector("position",this);this._width=new Number("width",this,undefined,undefined,0);this._height=new Number("height",this,undefined,undefined,0);this._anchor=new String("anchor",this,undefined,"none",Element.anchorValues);this._offset=new Vector("offset",this);if(data!=undefined)this.deserialize(data);if(component==undefined)component=new Component("g");else if(typeof component=="string")component=new Component(component);this._component=component;this._component.set("name",this._name);let parentElement=this.ancestor(Element.type);if(parentElement)parentElement.component.addChild(this._component)}get component(){return this._component}get position(){return this._position}get width(){return this._width}get height(){return this._height}get anchor(){return this._anchor}update(time,forced=false){if(Node.modified(this.position,this._width,this._height,this._offset)){let x=this._position.x.value,y=this._position.y.value,ox=this._offset.x.value,oy=this._offset.y.value,w=this._width.value,h=this._height.value;if(this._debugComponent){this._debugComponent.set("width",w);this._debugComponent.set("height",h)}if(x+ox!=0||y+oy!=0)this._component.set("transform","translate("+Number.toString(x+ox)+", "+Number.toString(y+oy)+")")}super.update(time,forced)}deserialize(data){if(data&&data.debug&&!this._debugComponent)this._debugComponent=new Component("rect",null,this._component.parent,{fill:"none",stroke:"green","stroke-width":2});super.deserialize(data)}}Element.type=new NodeType("Element","element",Node.type,Element);Element.anchorValues=["none","top-left","top","top-right","left","center","right","bottom-left","bottom","bottom-right"];class Segment extends Node{constructor(name,parent,data,type=Segment.type){super(name,parent,undefined,type);if(parent){this._parentPath=parent.ancestor(Path.type);if(!this._parentPath)throw Error("Invalid parent for Segment node:"+this.nodePath)}this._start=new Vector("start",this);this._end=new Vector("end",this);if(data!=undefined)this.deserialize(data);if(this._start.isUndefined&&this._parentPath)this.start.copy(this._parentPath.end)}get parentPath(){return this._parentPath}get start(){return this._start}get end(){return this._end}}Segment.type=new NodeType("Segment","segment",Node.type,Segment);class Line extends Segment{constructor(name,parent,data){super(name,parent,undefined,Line.type);if(data!=undefined)this.deserialize(data)}}Line.type=new NodeType("Line","line",Segment.type,Line);class Arc extends Segment{constructor(name,parent,data){super(name,parent,undefined,Arc.type);this._radius=new Number("radius",this,undefined,100,0);if(data!=undefined)this.deserialize(data)}get radius(){return this._radius}}Arc.type=new NodeType("Arc","arc",Segment.type,Arc);class Path extends Node{constructor(name,parent,data){super(name,parent,undefined,Path.type);this._segments=new NodeSet("segments",this,Segment.type);if(data!=undefined)this.deserialize(data)}get segments(){return this._segments}get start(){let segments=this._segments.count;if(segments==0)throw Error("No segments in: "+this.nodePath);return this._segments.getByIndex(0).start}get end(){let segments=this._segments.count;if(segments==0)throw Error("No segments in: "+this.nodePath);return this._segments.getByIndex(segments-1).end}update(time,forced=false){if(this.updated&&!forced)return;super.update(time,forced)}toSvg(offset=0){if(this.segments.count==0)return"";let segments=[],start=this.segments.first.start;let lastPoint;for(let segmentNode of this.segments){let node=segmentNode,a={x:node.start.x.value,y:node.start.y.value},b={x:node.end.x.value,y:node.end.y.value};if(!lastPoint||lastPoint.x!=a.x||lastPoint.y!=a.y)segments.push({type:"M",vertex:{x:a.x,y:a.y}});lastPoint=b;switch(node.type.name){case"Line":segments.push({type:"L",vertex:{x:b.x,y:b.y}});break;case"Arc":segments.push({type:"A",vertex:{x:b.x,y:b.y},radius:node.radius.value});break}}if(offset){let segIndex=0,segCount=segments.length;for(segIndex=0;segIndex<segCount;segIndex++){let normal={x:0,y:0},c=segments[segIndex].vertex;if(segIndex>0){let p=segments[segIndex-1].vertex;let x=c.y-p.y,y=c.x-p.x,l=Math.sqrt(x*x+y*y);normal.x-=x/l;normal.y+=y/l}if(segIndex<segCount-1){let n=segments[segIndex+1].vertex;let x=n.y-c.y,y=n.x-c.x,l=Math.sqrt(x*x+y*y);normal.x-=x/l;normal.y+=y/l}segments[segIndex].normal=normal}for(segIndex=0;segIndex<segCount;segIndex++){let normal=segments[segIndex].normal;segments[segIndex].vertex.x+=normal.x*offset;segments[segIndex].vertex.y+=normal.y*offset}}function n(n=0){if(n<Path._epsilon&&n>-Path._epsilon)n=0;return n.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:5}).replace(/,/g,"")}function v(v){return n(v.x)+" "+n(v.y)+" "}let svgData="";for(let segment of segments){switch(segment.type){case"M":svgData+="M "+v(segment.vertex);break;case"L":svgData+="L "+v(segment.vertex);break;case"A":svgData+="A "+segment.radius+" "+segment.radius+" 0 0 1 "+v(segment.vertex);break}}return svgData}}Path.type=new NodeType("Path","path",Node.type,Path);Path._epsilon=1e-5;class Shape extends Element{constructor(name,parent,data,type=Shape.type,fillComponentTag="path"){super(name,parent,undefined,type,"g");this._color=new Color("color",this,"url(#Foreground)");this._paths=new NodeSet("paths",this,Path.type);this._strokes=new NodeSet("strokes",this,Stroke.type);this._shapes=new NodeSet("shapes",this,Shape.type);this._path=new Component(fillComponentTag,null,this._component);if(data!=undefined)this.deserialize(data)}get color(){return this._color}get paths(){return this._paths}get fill(){return this._path}get strokes(){return this._strokes}get shapes(){return this._shapes}update(time,forced=false){if(this.updated&&!forced)return;if(!this._color.updated){let colorData=this._color.toString();if(colorData.startsWith("url(#"))colorData="url(#"+this.component.rootName+"Color"+colorData.slice(5);this._path.set("fill",colorData)}if(!this.paths.updated)this._path.set("d",this.toSVG());let x=this._position.x.value,y=this._position.y.value;if(x!=0&&y!=0)this._component.set("transform","translate("+x+" "+y+")");super.update()}toSVG(offset=0){let svgData="";for(let path of this._paths)svgData+=path.toSvg(offset)+" ";return svgData}}Shape.type=new NodeType("Shape","shape",Node.type,Shape);class Stroke extends Node{constructor(name,parent,data,type=Stroke.type){super(name,parent,undefined,type);if(parent){this._shape=parent.ancestor(Shape.type);if(!this.shape)throw Error("Invalid parent for Stroke node:"+this.nodePath)}this._component=new Component("path",null,this._shape.component,{fill:"none"});this._color=new Color("color",this,"url(#Accent)");this._width=new Number("width",this,1,0,0);this._offset=new Number("offset",this,0,0,0);if(data!=undefined)this.deserialize(data)}get shape(){return this._shape}get component(){return this._component}get color(){return this._color}get width(){return this._width}get offset(){return this._offset}update(time,forced){if(!this._offset.updated){let offset=this._offset.value;let shape=offset>0?this.shape.toSVG(offset):this._shape.fill.get("d");this._component.set("d",shape)}if(!this._color.updated){let colorData=this._color.toString();if(colorData.startsWith("url(#"))colorData="url(#"+this.component.rootName+"Color"+colorData.slice(5);this._component.set("stroke",colorData)}if(!this._width.updated)this._component.set("stroke-width",this._width.value)}}Stroke.type=new NodeType("Stroke","stroke",Node.type,Stroke);class Circle extends Shape{constructor(name,parent,data){super(name,parent,null,Circle.type);this._radius=new Number("radius",this,undefined,64,0);this._segments=new Number("segments",this,undefined,4,0);if(data!=undefined)this.deserialize(data)}get radius(){return this._radius}get segments(){return this._segments}update(time,forced=false){if(this.updated&&!forced)return;if(!this._radius.updated){this._paths.clear();let radius=this._radius.value,segments=this._segments.value,path=new Path("circlePath",this._paths),segment,angle=0,a=2*Math.PI/segments;for(segment=0;segment<segments;segment++,angle+=a){new Arc("segment "+segment,path.segments,{radius:this.radius.value,start:[Math.sin(angle)*radius,-Math.cos(angle)*radius],end:[Math.sin(angle+a)*radius,-Math.cos(angle+a)*radius]})}this._width.value=radius*2;this._height.value=radius*2}super.update()}}Circle.type=new NodeType("Circle","circle",Shape.type,Circle);class Rectangle extends Shape{constructor(name,parent,data){super(name,parent,null,Rectangle.type);this._width=new Number("width",this,undefined,128,0);this._height=new Number("height",this,undefined,128,0);this._radius=new Number("radius",this,undefined,0,0);if(data!=undefined)this.deserialize(data)}get width(){return this._width}get height(){return this._height}get radius(){return this._radius}update(time,forced=false){if(this.updated&&!forced)return;if(!this._width.updated||!this._height.updated||!this._radius.updated){this._paths.clear();let path=new Path("rectanglePath",this._paths),width=this._width.value,w=width/2,height=this._height.value,h=height/2,radius=this._radius.value;if(radius>w)radius=w;if(radius>h)radius=h;let segments=path.segments;segments.clear();if(radius==0){new Line("top",segments,{start:[-w,-h],end:[w,-h]});new Line("right",segments,{start:[w,-h],end:[w,h]});new Line("bottom",segments,{start:[w,h],end:[-w,h]});new Line("left",segments,{start:[-w,h],end:[-w,-h]})}else{let wr=w-radius,hr=h-radius;new Line("top",segments,{start:[-wr,-h],end:[wr,-h]});new Arc("top-right",segments,{start:[wr,-h],end:[w,-hr],radius:radius});new Line("right",segments,{start:[w,-hr],end:[w,hr]});new Arc("right-bottom",segments,{start:[w,hr],end:[wr,h],radius:radius});new Line("bottom",segments,{start:[wr,h],end:[-wr,h]});new Arc("bottom-left",segments,{start:[-wr,h],end:[-w,hr],radius:radius});new Line("left",segments,{start:[-w,hr],end:[-w,-hr]});new Arc("left-top",segments,{start:[-w,-hr],end:[-wr,-h],radius:radius})}}super.update()}}Rectangle.type=new NodeType("Rectangle","rectangle",Shape.type,Rectangle);class Polygon extends Shape{constructor(name,parent,data){super(name,parent,null,Polygon.type);this._radius=new Number("radius",this,undefined,64,0);this._segments=new Number("segments",this,undefined,4,0);if(data!=undefined)this.deserialize(data)}get radius(){return this._radius}get segments(){return this._segments}update(time,forced=false){if(this.updated&&!forced)return;if(!this._radius.updated){this._paths.clear();let radius=this._radius.value,segments=this._segments.value,path=new Path("polygonPath",this._paths),segment,angle=0,a=2*Math.PI/segments;for(segment=0;segment<segments;segment++,angle+=a){new Line("segment "+segment,path.segments,{start:[Math.sin(angle)*radius,-Math.cos(angle)*radius],end:[Math.sin(angle+a)*radius,-Math.cos(angle+a)*radius]})}this._width.value=radius*2;this._height.value=radius*2}super.update()}}Polygon.type=new NodeType("Polygon","polygon",Shape.type,Polygon);class Text extends Shape{constructor(name,parent,data){super(name,parent,null,Text.type,"text");this._content=new String("content",this,undefined,"[TEXT]");this._font=new String("font",this,undefined,"Arial");this._weight=new String("weight",this,undefined,"bold");this._fontSize=new Number("fontSize",this,undefined,20);this._align=new String("align",this,undefined,"center",Text.align);this._lines=[];if(data!=undefined)this.deserialize(data)}get font(){return this._font}get weight(){return this._weight}get fontSize(){return this._fontSize}get align(){return this._align}get anchor(){return this._anchor}update(time,forced=false){if(this.updated&&!forced)return;if(!this._font.updated)this._path.set("font-family",this._font.value);if(!this._weight.updated)this._path.set("font-weight",this._weight.value);if(!this._content.updated||!this._align.updated||!this._fontSize.updated){this._content.update();let lines=this._content.value.split("\n"),lineIndex=0,lineCount=lines.length,lineHeight=this._fontSize.value;this._path.set("font-size",lineHeight);while(this._lines.length<lineCount)this._lines.push(new Component("tspan",null,this._path));while(this._lines.length>lineCount)this._path.element.removeChild(this._lines.pop().element);let x=0,y=0,w=0,h=lineHeight*lineCount;if(this._path.element){let bb=this._path.element.getBoundingClientRect();w=bb.width}let horizontal="middle",vertical="middle";switch(this._align.value){case"left":horizontal="start";break;case"center":x+=w/2;horizontal="middle";break;case"right":x+=w;horizontal="end";break}switch(this._anchor.value){case"top":x-=w/2;vertical="top";break;case"top-right":x-=w;vertical="top";break;case"left":x=0;y+=h/2;break;case"center":x-=w/2;y+=h/2;break;case"right":x-=w;y+=h/2;break;case"bottom-left":y+=h;vertical="bottom";break;case"bottom":x-=w/2;y+=h;vertical="bottom";break;case"bottom-right":x-=w;y+=h;vertical="bottom";break}for(lineIndex=0;lineIndex<lineCount;lineIndex++){let line=this._lines[lineIndex];line.content=lines[lineIndex];line.set("x","0");line.set("y",lineHeight*lineIndex-y)}this._path.set("text-anchor",horizontal);this._path.set("dominant-baseline",vertical)}super.update()}}Text.type=new NodeType("Text","text",Shape.type,Text);Text.align=["left","center","right"];class Animation extends Node{constructor(name,parent,data){super(name,parent,undefined,Animation.type);this._curves=new NodeSet("curves",this,AnimationCurve.type);this._autoplay=new Boolean("autoplay",this);this._reverse=new Boolean("reverse",this);if(data!=undefined)this.deserialize(data);if(this._autoplay.value)this.play()}get curves(){return this._curves}get autoplay(){return this._autoplay}get reverse(){return this._reverse}get currentTime(){return this._currentTime}get previousTime(){return this._previousTime}play(times=1,reverse=false){if(SHISHOU.environment=="node")return;this._previousTime=undefined;this._reverse.value=reverse;this.update(document.timeline.currentTime.valueOf())}}Animation.type=new NodeType("Animation","animation",Node.type,Animation);class AnimationCurve extends Node{constructor(name,parent,data){super(name,parent,undefined,Animation.type);this._property=new String("property",this);this._keys=new NodeSet("keys",this,AnimationKey.type);this._easing=new String("easing",this);if(data!=undefined)this.deserialize(data)}get property(){return this._property}get keys(){return this._keys}get easing(){return this._easing}}AnimationCurve.type=new NodeType("AnimationCurve","curve",Node.type,AnimationCurve);class AnimationKey extends Node{constructor(name,parent,data){super(name,parent,undefined,AnimationKey.type);this._time=new Number("time",this);this._value=new Number("value",this);if(data!=undefined)this.deserialize(data)}get time(){return this._time}get value(){return this._value}}AnimationKey.type=new NodeType("AnimationKey","key",Node.type,AnimationKey);class Style extends Node{constructor(name,parent,data){super(name,parent,undefined,Style.type);this._colors=new NodeSet("colors",this,Color.type);this._font=new String("font",this);if(data!=undefined)this.deserialize(data)}get colors(){return this._colors}get font(){return this._font}apply(duration=0){let viewport=this.ancestor(Viewport.type);if(!viewport)throw Error("Unable to apply style: "+this.nodePath);let resourcesComponent=viewport.resourcesComponent;for(let color of this._colors){let colorName=viewport.name+"Color"+color.name;let component=resourcesComponent.getChild(colorName);if(!component)component=new Component("linearGradient",colorName,resourcesComponent,undefined,undefined,false);component.content='<stop stop-color="'+color.toString()+'" stop-opacity="1"/>'}}}Style.type=new NodeType("Style","style",Node.type,Style);class Viewport extends Element{constructor(name,parent,data){let uniqueId=name||"Viewport"+(Viewport.instances.length>0?Viewport.instances.length:"");super(uniqueId,parent,undefined,Viewport.type,new Component("svg",uniqueId,undefined,{xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink",style:"user-select: none; overflow: hidden; "+"width: 16px; height:16px; background: none;"}));Viewport.instances.push(this);let resourcesId=uniqueId+" Resources",scriptsId=uniqueId+" Scripts",backgroundId=uniqueId+" Background",layersId=uniqueId+" Layers";this._resourcesComponent=new Component("defs",resourcesId,this._component,{id:resourcesId});this._scriptComponent=new Component("script",scriptsId,this._component,{id:scriptsId});this._backgroundComponent=new Component("rect",backgroundId,this._component,{id:backgroundId,fill:"url(#"+uniqueId+"Color)"});this._layersComponent=new Component("g",layersId,this._component,{id:layersId});this._state=new String("state",this,undefined,"normal",Viewport.states);this._style=new String("style",this);this._parentElement=new String("parentElement",this);this._color=new Color("color",this);this._styles=new NodeSet("styles",this,Style.type);this._shapes=new NodeSet("shapes",this,Shape.type);this._layers=new NodeSet("layers",this,Layer.type);this._width.default=512;this._height.default=256;if(data!=undefined)this.deserialize(data);if(this._styles.count==0){new Style("default",this._styles,Viewport.defaultStyle);this._style.value="default"}else if(this._style.value==undefined)this._style.value=this._styles.getByIndex(0).name;let parentElementId=this._parentElement.value;if(parentElementId!=undefined){let parentElement=document.getElementById(parentElementId);if(!parentElement)throw Error('Invalid HTML Element ID: "'+parentElementId+'" for: '+this.nodePath);parentElement.append(this._component.element)}this.resize(undefined,undefined,true);if(SHISHOU.environment=="browser")window.addEventListener("resize",(()=>{this.resize()}));this.update()}get resourcesComponent(){return this._resourcesComponent}get scriptComponent(){return this._scriptComponent}get backgroundComponent(){return this._backgroundComponent}get layersComponent(){return this._layersComponent}get state(){return this._state}get style(){return this._style}get parentElement(){return this._parentElement}get color(){return this._color}get styles(){return this._styles}get shapes(){return this._shapes}get layers(){return this._layers}update(time,forced=false){if(!this._style.updated&&this.styles.count>0){let style=this._styles.get(this._style.value);if(!style)throw Error("Invalid style: "+this._style.value);style.apply()}if(Node.modified(this.state,this._width,this._height))this.resize(this._width.value,this._height.value);if(!this._color.updated){let colorData=this._color.toString();if(colorData.startsWith("url(#"))colorData="url(#"+this.component.rootName+"Color"+colorData.slice(5);this._backgroundComponent.set("fill",colorData)}if(SHISHOU.environment=="browser")requestAnimationFrame(this.update.bind(this));super.update(time,forced)}resize(width,height,forced=false){if(SHISHOU.environment=="browser"){let element=this._component.element;switch(this._state.value){case"hidden":break;case"normal":if(width==undefined)width=this._width.value;if(height==undefined)height=this._height.value;element.style.position="inline";element.style.width=width+"px";element.style.height=height+"px";break;case"maximized":element.style.position=this._parentElement.isUndefined?"fixed":"relative";element.style.top="0";element.style.left="0";element.style.width="100%";element.style.height="100%";break}width=element.clientWidth;height=element.clientHeight}if(!forced&&this._width.value==width&&this._height.value==height)return;this._width.value=width;this._height.value=height;this._component.set("viewBox","0 0 "+width+" "+height);let background=this._backgroundComponent;if(!this._width.updated)background.set("width",this._width.value);if(!this._height.updated)background.set("height",this._height.value);if(this.debug)console.log("Resized Viewport "+this.name+": "+width+" x "+height+" ("+this._state.value+")");for(let layer of this._layers)layer.resize(width,height);this._width.update();this._height.update()}}Viewport.type=new NodeType("Viewport","viewport",Element.type,Viewport);Viewport.states=["hidden","normal","maximized","fullscreen"];Viewport.defaultWidth=512;Viewport.defaultHeight=256;Viewport.defaultStyle={font:"Arial",colors:{Background:"#00000",Foreground:"#FFFFFF",Accent:"#B400CF"}};Viewport.instances=[];class Context extends Node{constructor(name,parent,data){super(name,parent,undefined,Context.type);this._variable=new NodeLink("variable",this);this._value=new String("value",this);if(data!=undefined)this.deserialize(data)}get variable(){return this._variable}get value(){return this._value}update(time,forced=false){super.update(time,forced)}validate(){if(this.value.isUndefined)return true;if(!this.variable.updated)this.variable.update();let ref=this.variable.node;let result=ref.value==this.value.value;return result}toString(){if(!this.variable.node)return"{Undefined}";return this.variable.node.name+" == "+this._value.value}}Context.type=new NodeType("Context","context",Node.type,Context);class Action extends Node{constructor(name,parent,data){super(name,parent,undefined,Action.type);this._event=new String("event",this);this._variable=new NodeLink("variable",this);this._value=new String("value",this);if(data!=undefined)this.deserialize(data)}get event(){return this._event}get variable(){return this._variable}get value(){return this._value}}Action.type=new NodeType("Action","action",Node.type,Action);class Widget extends Element{constructor(name,parent,data,type=Widget.type){super(name,parent,undefined,type);this._abstract=new Boolean("abstract",this);this._extends=new NodeLink("extends",this);this._context=new Context("context",this);this._variables=new NodeSet("variables",this,Simple.type);this._actions=new NodeSet("actions",this,Action.type);this._shapes=new NodeSet("shapes",this,Shape.type);this._widgets=new NodeSet("widgets",this,Widget.type);if(data!=undefined)this.deserialize(data);this._component.element.addEventListener("click",(event=>{this.react(event)}))}get abstract(){return this._abstract}get extends(){return this._extends}get context(){return this._context}get variables(){return this._variables}get actions(){return this._actions}get shapes(){return this._shapes}get widgets(){return this._widgets}react(event){let actionPerformed=false;for(let action of this._actions){if(action.event.value==event.type){let node=action.variable.node;node.value=action.value.value;actionPerformed=true;console.log("Set: "+node.nodePath+" <- "+node.value)}}if(actionPerformed)event.stopPropagation()}deserialize(data={}){if(data==undefined||typeof data!="object")return;if(data.extends){this._extends.reference=data.extends;let target=this._extends.node;let copyData=target.serialize();if(copyData.abstract)copyData.abstract=undefined;for(let key in copyData)if(!data[key])data[key]=copyData[key]}let items=Object.keys(data);for(let item of items)if(this._children[item]!=undefined&&data[item]!=undefined)this.children[item].deserialize(data[item]);if(data.debug)this._debug=data}update(time,forced=false){if(this._abstract.value==true)return;let con=this._context.validate();this._component.set("visibility",con?"visible":"hidden");super.update(time,forced)}}Widget.type=new NodeType("Widget","widget",Widget.type,Widget);class Layer extends Element{constructor(name,parent,data,type=Layer.type){super(name,parent,undefined,type);this._pan=new Boolean("pan",this,undefined,false);this._zoom=new Number("zoom",this,undefined,1,.1,10);this._shapes=new NodeSet("shapes",this,Shape.type);this._widgets=new NodeSet("widgets",this,Widget.type);if(data!=undefined)this.deserialize(data);let viewport=this.ancestor(Viewport.type);if(!viewport)throw Error("Layer without viewport: "+this.nodePath);viewport.layersComponent.addChild(this._component);let parentElement=viewport.component.element;parentElement.addEventListener("contextmenu",(e=>e.preventDefault()));parentElement.addEventListener("mousedown",(e=>{if(!this._pan.value)return;this.react("down",e.buttons,e.offsetX,e.offsetY,e.movementX,e.movementY);e.preventDefault()}));parentElement.addEventListener("mousemove",(e=>{if(!this._pan.value)return;this.react("move",e.buttons,e.offsetX,e.offsetY,e.movementX,e.movementY);e.preventDefault()}));parentElement.addEventListener("mouseup",(e=>{if(!this._pan.value)return;this.react("up",e.buttons,e.offsetX,e.offsetY,e.movementX,e.movementY);e.preventDefault()}));parentElement.addEventListener("wheel",(e=>{if(!this._pan.value)return;this.react("zoom",e.buttons,e.offsetX,e.offsetY,e.movementX,e.movementY,e.deltaY<0?.1:-.1);e.preventDefault()}))}get pan(){return this._pan}get zoom(){return this._zoom}get shapes(){return this._shapes}get widgets(){return this._widgets}deserialize(data){if(data&&data.debug&&!this._debugComponent){this._debugComponent=new Component("g",undefined,this._component,{"stroke-linecap":"round"});function createGrid(name,size,width,divisions=10,parentComponent){let grid=new Component("g",name,parentComponent,{id:name,stroke:"gray","stroke-width":width});let s=size/2,cellSize=size/divisions;for(let a=-s;a<=s;a+=cellSize){new Component("line",null,grid,{x1:-s,y1:a,x2:s,y2:a});new Component("line",null,grid,{x1:a,y1:-s,x2:a,y2:s})}}createGrid("grid1",1e3,.5,10,this._debugComponent);createGrid("grid2",200,.2,20,this._debugComponent);new Component("line",undefined,this._debugComponent,{y1:-1e3,y2:1e3,stroke:"green"});new Component("line",undefined,this._debugComponent,{x1:-1e3,x2:1e3,stroke:"red"})}super.deserialize(data)}update(time,forced=false){let updateTransform=Node.modified(this._width,this._height,this._position,this._offset,this._zoom);super.update(time,forced);if(updateTransform){let x=this._position.x.value,y=this._position.y.value,ox=this._offset.x.value,oy=this._offset.y.value,w=this._width.value,h=this._height.value,z=this._zoom.value;this._component.set("transform","scale("+Number.toString(z)+") "+"translate("+Number.toString((x+ox)/z)+", "+Number.toString((y+oy)/z)+")")}}resize(width=0,height=0){this._offset.x.value=width/2;this._offset.y.value=height/2;this._width.value=width;this._height.value=height}react(action,button,x,y,mx,my,mz){if(action=="move"){switch(button){case 1:this._position.addValues(mx,my);return}}if(action=="zoom"){let oldZoom=this._zoom.value,newZoom=this._zoom.value+mz;if(newZoom<this._zoom.min)newZoom=this._zoom.min;if(newZoom>this._zoom.max)newZoom=this._zoom.max;this._zoom.value=newZoom;newZoom=this._zoom.value;let relX=-(this._position.x.value+this._offset.x.value),relY=-(this._position.y.value+this._offset.y.value);let oldX=(x+relX)*oldZoom,oldY=(y+relY)*oldZoom,newX=(x+relX)*newZoom,newY=(y+relY)*newZoom;this._position.x.value+=(oldX-newX)/oldZoom;this._position.y.value+=(oldY-newY)/oldZoom}}}Layer.type=new NodeType("Layer","layer",Element.type,Layer);class Generator extends Widget{constructor(name,parent,data,type=Generator.type){super(name,parent,undefined,type);this._widget=new NodeLink("widget",this);this._seed=new Number("seed",this);this._classType=new String("class",this);this._linkColor=new Color("color",this);this._classes={};if(data!=undefined)this.deserialize(data)}update(time,forced=false){if(this.updated&&!forced)return;if(this._abstract.value==true)return;if(!this._widget.updated)this._widget.update();let root=this.ancestor(SHISHOU.type);let model=root.model;let lines={},lineArray=[],lineIndex=0,colors=["#ef1de5","#037e8e","#00abcd","#620d7d","#b206f9","#082ebf","#a59dcc","#582bb1"],widths=[10,10,10,10,10,10,10,10];for(let lineData of model.relations){let line={name:lineData.name,nodes:[],path:[],color:colors[lineIndex],width:widths[lineIndex],links:[],segments:[],paths:[]};lines[lineData.name]=line;lineArray.push(line);lineIndex++}let lineNames=Object.keys(lines),lineCount=lineNames.length;let nodes={},nodeArray=[];for(let nodeData of model.classes){if(nodeData.abstract.value)continue;let node={name:nodeData.name,data:nodeData,lines:[],links:[],position:new Vector(nodeData.name+"Position")};for(let relation of nodeData.relations){node.lines.push(relation.name);lines[relation.name].nodes.push(nodeData.name)}node.lineCount=node.lines.length;nodes[nodeData.name]=node;nodeArray.push(node)}let nodeNames=Object.keys(nodes),nodeCount=nodeNames.length;let sortedLines=lineArray.sort(((a,b)=>b.nodes.length-a.nodes.length));let sortedNodes=nodeArray.sort(((a,b)=>b.lines.length-a.lines.length));let grid=[],gridRadius=64,gridSize=1+gridRadius*2,gridCenter=gridRadius,cursorX=0,cursorY=0,positionedNodes=0,separation=3,cellSize=100,previousNodeInLine;for(let y=0;y<gridSize;y++){let row=[];grid.push(row);for(let x=0;x<gridSize;x++)row.push({node:undefined,direction:undefined,links:[]})}let links={},linksArray=[];for(let line of sortedLines){line.nodes=line.nodes.sort(((a,b)=>nodes[b].lines.length-nodes[a].lines.length));previousNodeInLine=null;for(let nodeName of line.nodes){let node=nodes[nodeName];if(node.position.isUndefined){let a=positionedNodes*30,r=a*Math.PI/180,distance=2+a/360,oX=Math.round(distance*Math.sin(r)),oY=Math.round(distance*Math.cos(r));let x=cursorX+oX*separation,y=cursorY+oY*separation,cell=grid[gridCenter+x][gridCenter+y];if(!cell.node){cell.node=node;node.position.set(x,y);positionedNodes++;console.log('Set: "'+node.name+'": '+x+", "+y)}else throw Error("There is already a node in that cell")}if(!previousNodeInLine){previousNodeInLine=node;continue}let start=previousNodeInLine.position,end=node.position,current=start.values,goal=end.values,link={line:line.name,start:previousNodeInLine.name,end:node.name,path:[current]};let iterations=0,maxIterations=1e3;while(++iterations<maxIterations){let options=[{x:current.x+0,y:current.y-1},{x:current.x+1,y:current.y-1},{x:current.x+1,y:current.y+0},{x:current.x+1,y:current.y+1},{x:current.x+0,y:current.y+1},{x:current.x-1,y:current.y+1},{x:current.x-1,y:current.y+0},{x:current.x-1,y:current.y-1}];let bestOption=undefined,bestUtility=1e4;for(let option of options){let c=grid[gridCenter+option.x][gridCenter+option.y];let d={x:goal.x-option.x,y:goal.y-option.y};if(d.x==0&&d.y==0){bestOption=option;bestUtility=0;break}if(c.node)continue;let utility=Math.sqrt(d.x*d.x+d.y*d.y);if(utility<bestUtility){bestUtility=utility;bestOption=option}}link.path.push(bestOption);if(bestUtility>0)current=bestOption;else break}if(iterations==maxIterations)throw Error('Unable to create link between "'+link.start+'" and "'+link.end+'"');let pathIndex,pathLength=link.path.length;for(pathIndex=1;pathIndex<pathLength-1;pathIndex++){let pos=link.path[pathIndex],cell=grid[pos.x+gridRadius][pos.y+gridRadius];cell.links.push(link)}node.links.push(link);linksArray.push(link);previousNodeInLine=node}}for(let link of linksArray){let path=link.path,pathIndex,pathLength=link.path.length;for(pathIndex=0;pathIndex<pathLength-1;pathIndex++){let a=path[pathIndex],b=path[pathIndex+1],ax=a.x,ay=a.y,bx=b.x,by=b.y;let line=lines[link.line];line.segments.push({type:"line",start:{x:ax*100,y:ay*100},end:{x:bx*100,y:by*100}})}}for(let line of lineArray){if(line.segments.length==0)continue;console.log(line.segments);this.shapes.add("shape",{color:"none",paths:[{segments:line.segments}],strokes:[{width:line.width,color:line.color}]})}let widgetIndex=1;for(let node of sortedNodes){let widgetData=this._widget.node.serialize();if(!widgetData.name)widgetData.name="Widget";widgetData.name+=widgetIndex;widgetData.abstract=false;if(!node.data.title.isUndefined)widgetData.variables.title=node.data.title.value;if(!node.data.description.isUndefined)widgetData.variables.description=node.data.description.value;if(node.position.isUndefined)continue;let p=node.position.values;widgetData.position={x:p.x*cellSize,y:p.y*cellSize};this._widgets.add(widgetData.name,widgetData);widgetIndex++}super.update(time,forced)}}Generator.type=new NodeType("Generator","generator",Widget.type,Generator);class SHISHOU extends Node{constructor(data){let instanceCount=SHISHOU.instances.length;super("SHISHOU"+(instanceCount>0?"_"+instanceCount:""),undefined,undefined,SHISHOU.type);SHISHOU.instances.push(this);if(instanceCount==0)console.log("INITIALIZED "+SHISHOU.name+" Version: "+SHISHOU.version+" (Environment: "+SHISHOU.environment+")");this._title=new String("title",this,data&&data.title?data.title:this.name);this._model=new Model("model",this);this._viewports=new NodeSet("viewports",this,Viewport.type);if(data){if(typeof data!="object")throw Error("Invalid data for "+this.nodePath);this.deserialize(data)}if(this._viewports.count==0){new Viewport("DefaultViewport",this._viewports,{state:"maximized",layers:[{pan:true,debug:true}]})}this.update()}get title(){return this._title}get model(){return this._model}get viewports(){return this._viewports}static init(data){if(typeof data=="object")return new SHISHOU(data);else if(typeof data=="string"){fetch(data).then((response=>response.text())).then((data=>{let d=JsonSerialization.deserialize(data)}));return new SHISHOU}else throw Error("Invalid data for SHISHOU initialization")}}SHISHOU.type=new NodeType("SHISHOU","root",Node.type,SHISHOU);SHISHOU.version="0.1";SHISHOU.instances=[];SHISHOU.environment=[typeof window,typeof document].includes("undefined")?"node":"browser";

//# sourceMappingURL=shishou.min.js.map

SHISHOU.init('InteroperabilityMap.jsonc');

console.log(s.model)
		</script>
	</body>
</html>